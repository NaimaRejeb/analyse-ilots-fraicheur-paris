# =============================================================================# PROJET R: ANALYSE AVANCEE DES ILOTS DE FRAICHEUR DE PARIS# Auteur: Naima Rejeb - Data Science & AI G1# Cartes geographiques et visualisations avancees# =============================================================================# Chargement des packageslibrary(plotrix)        # Graphiques avanceslibrary(RColorBrewer)   # Palettes de couleurs# 1. IMPORTATION DES DONNEES -----------------------------------------------cat("=== CHARGEMENT DES DONNEES ===\n")url <- "https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/ilots-de-fraicheur-equipements-activites/exports/csv"donnees <- read.csv2(url, encoding = "UTF-8", stringsAsFactors = FALSE)cat("[OK]", nrow(donnees), "ilots de fraicheur charges\n\n")# 2. EXTRACTION DES COORDONNEES GEOGRAPHIQUES -------------------------------cat("=== EXTRACTION DES COORDONNEES ===\n")# Extraire latitude et longitude depuis geo_point_2dif ("geo_point_2d" %in% names(donnees)) {  coords <- strsplit(donnees$geo_point_2d, ",")  donnees$latitude <- as.numeric(sapply(coords, function(x) if(length(x) >= 1) trimws(x[1]) else NA))  donnees$longitude <- as.numeric(sapply(coords, function(x) if(length(x) >= 2) trimws(x[2]) else NA))    # Retirer les lignes sans coordonnees  donnees_geo <- donnees[!is.na(donnees$latitude) & !is.na(donnees$longitude), ]  cat("[OK]", nrow(donnees_geo), "ilots avec coordonnees GPS valides\n\n")}# 3. CARTE GEOGRAPHIQUE DES ILOTS DE FRAICHEUR -----------------------------cat("=== GENERATION DE LA CARTE ===\n")# Creer une palette de couleurs par typetypes_uniques <- unique(donnees_geo$type)types_uniques <- types_uniques[types_uniques != ""]couleurs_types <- brewer.pal(min(12, length(types_uniques)), "Set3")if(length(types_uniques) > 12) {  couleurs_types <- colorRampPalette(brewer.pal(12, "Set3"))(length(types_uniques))}names(couleurs_types) <- types_uniques# Assigner une couleur a chaque pointdonnees_geo$couleur <- couleurs_types[match(donnees_geo$type, types_uniques)]donnees_geo$couleur[is.na(donnees_geo$couleur)] <- "gray"# CARTE 1: Carte de densite des ilotspng("outputs/carte_ilots_fraicheur.png", width=1200, height=1000, res=120)par(mar=c(5,5,4,2))plot(donnees_geo$longitude, donnees_geo$latitude,     pch=19, cex=1.2,     col=donnees_geo$couleur,     main="Carte des Ilots de Fraicheur a Paris",     xlab="Longitude", ylab="Latitude",     las=1, cex.main=1.5, cex.lab=1.2)# Ajouter une grillegrid(col="gray80", lty=2)# Legendelegend("topright",        legend=head(types_uniques, 8),        col=head(couleurs_types, 8),       pch=19, cex=0.8, bg="white")dev.off()cat("[OK] Carte sauvegardee: outputs/carte_ilots_fraicheur.png\n")# CARTE 2: Carte de densite (heatmap)png("outputs/carte_densite.png", width=1200, height=1000, res=120)par(mar=c(5,5,4,2))# Creer une densite 2Ddensite <- MASS::kde2d(donnees_geo$longitude, donnees_geo$latitude, n=100)# Afficher la densiteimage(densite, col=rev(heat.colors(20)),      main="Carte de Densite des Ilots de Fraicheur",      xlab="Longitude", ylab="Latitude",      cex.main=1.5, cex.lab=1.2)# Ajouter les contourscontour(densite, add=TRUE, col="blue", lwd=1.5)# Ajouter les pointspoints(donnees_geo$longitude, donnees_geo$latitude,        pch=20, cex=0.3, col="black")dev.off()cat("[OK] Carte de densite sauvegardee: outputs/carte_densite.png\n\n")# 4. GRAPHIQUES AVANCES ----------------------------------------------------cat("=== CREATION DES GRAPHIQUES AVANCES ===\n")# GRAPHIQUE 1: Pyramide comparative par arrondissementpng("outputs/pyramide_arrondissements.png", width=1400, height=1000, res=120)# Calculer les statistiques par arrondissementarrd_stats <- table(donnees$arrondissement)arrd_df <- data.frame(  arrondissement = names(arrd_stats),  total = as.numeric(arrd_stats))arrd_df <- arrd_df[order(-arrd_df$total), ]# Creer le graphique pyramidalpar(mar=c(5,8,4,2))barplot(arrd_df$total,         names.arg=arrd_df$arrondissement,        horiz=TRUE, las=1,        col=colorRampPalette(c("lightblue", "darkblue"))(nrow(arrd_df)),        border=NA,        main="Repartition des Ilots de Fraicheur par Arrondissement",        xlab="Nombre d'ilots",        cex.main=1.5, cex.lab=1.2, cex.names=0.9)grid(nx=NA, ny=NULL, col="white", lwd=1.5)dev.off()cat("[OK] Pyramide sauvegardee: outputs/pyramide_arrondissements.png\n")# GRAPHIQUE 2: Graphique radar des types d'equipementspng("outputs/radar_types.png", width=1000, height=1000, res=120)type_stats <- table(donnees$type)type_stats <- sort(type_stats, decreasing=TRUE)[1:min(8, length(type_stats))]# Creer le graphique radarradial.plot(as.numeric(type_stats),            labels=names(type_stats),            rp.type="p",            main="Distribution des Types d'Equipements\n(Top 8)",            line.col="darkblue",            lwd=3,            poly.col=rgb(0, 0, 1, 0.3),            show.grid.labels=3,            radial.lim=c(0, max(type_stats)*1.1),            cex.main=1.5)dev.off()cat("[OK] Graphique radar sauvegarde: outputs/radar_types.png\n")# GRAPHIQUE 3: Diagramme en camembert 3D pour les types principauxpng("outputs/pie3d_types.png", width=1200, height=900, res=120)type_top10 <- sort(table(donnees$type), decreasing=TRUE)[1:10]couleurs_pie <- brewer.pal(10, "Spectral")pie3D(as.numeric(type_top10),      labels=paste(names(type_top10), "\n", round(type_top10/sum(type_top10)*100, 1), "%"),      col=couleurs_pie,      main="Top 10 des Types d'Equipements (3D)",      labelcex=0.9,      explode=0.1,      cex.main=1.5)dev.off()cat("[OK] Camembert 3D sauvegarde: outputs/pie3d_types.png\n")# GRAPHIQUE 4: Graphique a bulles (Arrondissement vs Type)png("outputs/bubble_arrd_type.png", width=1400, height=1000, res=120)# Top 5 arrondissements et top 5 typestop_arrd <- head(names(sort(table(donnees$arrondissement), decreasing=TRUE)), 5)top_types <- head(names(sort(table(donnees$type), decreasing=TRUE)), 5)# Creer une matrice de comptagematrice_bubble <- matrix(0, nrow=length(top_arrd), ncol=length(top_types))rownames(matrice_bubble) <- top_arrdcolnames(matrice_bubble) <- top_typesfor(i in 1:nrow(donnees)) {  if(donnees$arrondissement[i] %in% top_arrd && donnees$type[i] %in% top_types) {    r <- which(top_arrd == donnees$arrondissement[i])    c <- which(top_types == donnees$type[i])    matrice_bubble[r, c] <- matrice_bubble[r, c] + 1  }}# Creer le graphiquepar(mar=c(8,8,4,2))plot(0, 0, type="n", xlim=c(0.5, length(top_types)+0.5),      ylim=c(0.5, length(top_arrd)+0.5),     xlab="", ylab="", xaxt="n", yaxt="n",     main="Analyse Croisee: Arrondissement x Type d'Equipement",     cex.main=1.5)axis(1, at=1:length(top_types), labels=top_types, las=2, cex.axis=0.9)axis(2, at=1:length(top_arrd), labels=top_arrd, las=1, cex.axis=0.9)# Ajouter les bullesfor(i in 1:nrow(matrice_bubble)) {  for(j in 1:ncol(matrice_bubble)) {    if(matrice_bubble[i,j] > 0) {      taille <- sqrt(matrice_bubble[i,j]) * 0.5      couleur <- colorRampPalette(c("yellow", "red"))(max(matrice_bubble)+1)[matrice_bubble[i,j]+1]      draw.circle(j, i, radius=taille, col=couleur, border="black", lwd=1.5)      text(j, i, matrice_bubble[i,j], cex=0.8, font=2)    }  }}dev.off()cat("[OK] Graphique a bulles sauvegarde: outputs/bubble_arrd_type.png\n")# GRAPHIQUE 5: Histogramme empile payant/gratuit par typepng("outputs/stacked_payant_type.png", width=1400, height=900, res=120)# Top 8 typestop8_types <- head(names(sort(table(donnees$type), decreasing=TRUE)), 8)donnees_top8 <- donnees[donnees$type %in% top8_types, ]# Creer la matrice pour l'histogramme empilematrice_stack <- table(donnees_top8$type, donnees_top8$payant)par(mar=c(8,5,4,8))barplot(t(matrice_stack),         beside=FALSE,        col=c("gray80", "#2ecc71", "#e74c3c"),        main="Accessibilite par Type d'Equipement (Top 8)",        xlab="", ylab="Nombre d'equipements",        las=2, cex.main=1.5, cex.lab=1.2,        border=NA)legend("topright", inset=c(-0.15, 0), xpd=TRUE,       legend=c("Non renseigne", "Gratuit", "Payant"),       fill=c("gray80", "#2ecc71", "#e74c3c"),       cex=1.1, title="Acces")dev.off()cat("[OK] Histogramme empile sauvegarde: outputs/stacked_payant_type.png\n")# GRAPHIQUE 6: Diagramme de Cleveland pour comparaison arrondissementspng("outputs/cleveland_arrondissements.png", width=1200, height=1000, res=120)arrd_sorted <- sort(table(donnees$arrondissement))couleurs_cleveland <- colorRampPalette(c("lightblue", "darkblue"))(length(arrd_sorted))par(mar=c(5,8,4,2))dotchart(as.numeric(arrd_sorted),         labels=names(arrd_sorted),         col=couleurs_cleveland,         pch=19, cex=1.5,         main="Comparaison des Arrondissements\n(Diagramme de Cleveland)",         xlab="Nombre d'ilots de fraicheur",         cex.main=1.5, cex.lab=1.2)grid(nx=NULL, ny=NA, col="gray80")dev.off()cat("[OK] Diagramme de Cleveland sauvegarde: outputs/cleveland_arrondissements.png\n")# 5. STATISTIQUES AVANCEES -------------------------------------------------cat("\n=== STATISTIQUES AVANCEES ===\n")# Analyse de correlation spatialeif(nrow(donnees_geo) > 0) {  # Calculer la distance moyenne au centre de Paris (approximation: 48.8566, 2.3522)  centre_lat <- 48.8566  centre_lon <- 2.3522    donnees_geo$distance_centre <- sqrt(    (donnees_geo$latitude - centre_lat)^2 +     (donnees_geo$longitude - centre_lon)^2  ) * 111  # Approximation en km    # Statistiques par zone (centre vs peripherie)  donnees_geo$zone <- ifelse(donnees_geo$distance_centre < 0.05, "Centre", "Peripherie")    cat("\n--- Repartition Centre vs Peripherie ---\n")  zone_stats <- table(donnees_geo$zone)  print(zone_stats)    cat("\n--- Top 3 types par zone ---\n")  cat("\nCentre:\n")  centre_types <- head(sort(table(donnees_geo$type[donnees_geo$zone == "Centre"]), decreasing=TRUE), 3)  print(centre_types)    cat("\nPeripherie:\n")  peri_types <- head(sort(table(donnees_geo$type[donnees_geo$zone == "Peripherie"]), decreasing=TRUE), 3)  print(peri_types)}# Creer un resume statistiqueresume <- data.frame(  Indicateur = c(    "Nombre total d'ilots",    "Nombre de types differents",    "Type le plus frequent",    "Arrondissement avec le plus d'ilots",    "Pourcentage d'acces gratuit",    "Pourcentage d'acces payant"  ),  Valeur = c(    nrow(donnees),    length(unique(donnees$type[donnees$type != ""])),    names(sort(table(donnees$type), decreasing=TRUE))[1],    names(sort(table(donnees$arrondissement), decreasing=TRUE))[1],    paste0(round(sum(donnees$payant == "Non", na.rm=TRUE) / nrow(donnees) * 100, 1), "%"),    paste0(round(sum(donnees$payant == "Oui", na.rm=TRUE) / nrow(donnees) * 100, 1), "%")  ))write.csv(resume, "outputs/resume_statistique.csv", row.names=FALSE)cat("\n[OK] Resume statistique sauvegarde: outputs/resume_statistique.csv\n")# 6. RAPPORT FINAL ---------------------------------------------------------cat("\n")cat("================================================================\n")cat("       ANALYSE AVANCEE TERMINEE AVEC SUCCES                    \n")cat("================================================================\n")cat("  Fichiers generes dans le dossier 'outputs':                  \n")cat("                                                                \n")cat("  [CARTES]                                                      \n")cat("     - carte_ilots_fraicheur.png                               \n")cat("     - carte_densite.png                                       \n")cat("                                                                \n")cat("  [GRAPHIQUES]                                                  \n")cat("     - pyramide_arrondissements.png                            \n")cat("     - radar_types.png                                         \n")cat("     - pie3d_types.png                                         \n")cat("     - bubble_arrd_type.png                                    \n")cat("     - stacked_payant_type.png                                 \n")cat("     - cleveland_arrondissements.png                           \n")cat("                                                                \n")cat("  [DONNEES]                                                     \n")cat("     - resume_statistique.csv                                  \n")cat("================================================================\n")cat("\n")